---
import { getCollection } from "astro:content";

import Layout from "../layouts/Layout.astro";
import Print from "../components/Print.astro";

const prints = await getCollection("prints");
---

<Layout title="Samuel Colman: A Catalogue RaisonnÃ© of Etchings">
	<form id="sort-ui" class="text-right pb-2">
		<label for="sort" class="text-sm">Sort by:</label>

		<select id="sort" name="sort" class="rounded-lg p-1.5 text-sm">
			<option value="slug">Date of creation</option>
			<option value="id">Catalogue number</option>
		</select>
	</form>

	<div id="prints">
		{prints.map((p) => <Print slug={p.slug} />)}
	</div>
</Layout>

<script>
	function getSorter(attr) {
		let caster = (d) => d;

		if (attr == "id") {
			caster = Number.parseInt;
		}

		return function comparator(a, b) {
			if (caster(a.dataset[attr]) < caster(b.dataset[attr])) return -1;
			if (caster(a.dataset[attr]) > caster(b.dataset[attr])) return 1;
			return 0;
		};
	}

	document.getElementById("sort").onchange = (event) => {
		var printDivs = Array.from(document.querySelectorAll(`.print`));
		let sorted = printDivs.sort(getSorter(event.target.value));
		sorted.forEach((e) => document.querySelector("#prints").appendChild(e));
	};
</script>
